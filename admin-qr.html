<!DOCTYPE html>
<html>
<head>
    <title>UbiPet Admin QR</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üè∑Ô∏è Ubipet QR Admin</h1>
    <div id="status">Cargando...</div>
    
    <script>
        const supabaseUrl = 'https://exeeqykieytuvlzdbsnn.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4ZWVxeWtpZXl0dXZsemRic25uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDQ1MjMsImV4cCI6MjA4NzE4MDUyM30.874QQz_xUpJW7tT_iHWyiaeKELmK4reYYOzzlieMJq4';
        
        const sb = supabase.createClient(supabaseUrl, supabaseKey);
        
        async function testConnection() {
            const status = document.getElementById('status');
            status.innerHTML = 'üîç Probando conexi√≥n...';
            
            try {
                const { data, error } = await sb.from('perfiles').select('count').limit(1);
                
                if (error) {
                    status.innerHTML = `‚ùå Error: ${error.message}`;
                    console.error('ERROR:', error);
                    return;
                }
                
                status.innerHTML = `‚úÖ Conexi√≥n OK. Perfiles encontrados: ${data?.length || 0}`;
                
                if (data?.length > 0) {
                    cargarTodosPerfiles();
                } else {
                    status.innerHTML += '<br>‚ÑπÔ∏è <a href="perfil.html">Guarda tu mascota primero</a>';
                }
                
            } catch (e) {
                status.innerHTML = `üí• Error total: ${e.message}`;
                console.error('Error:', e);
            }
        }
        
        async function cargarTodosPerfiles() {
            const status = document.getElementById('status');
            status.innerHTML = 'üì± Cargando perfiles...';
            
            try {
                const { data, error } = await sb.from('perfiles').select('*');
                
                if (error) throw error;
                
                status.innerHTML = `‚úÖ ${data.length} mascotas listas`;
                
                data.forEach(perfil => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <h3>${perfil.nombre}</h3>
                        <p>${perfil.raza} - ${perfil.telefono}</p>
                        <p>ID: ${perfil.id}</p>
                        <a href="perfil-publico.html?id=${perfil.id}" target="_blank">Ver perfil p√∫blico</a>
                        <hr>
                    `;
                    document.body.appendChild(div);
                });
                
            } catch (e) {
                status.innerHTML = `Error: ${e.message}`;
            }
        }
        
        // INICIO
        testConnection();
    </script>
</body>
</html>
